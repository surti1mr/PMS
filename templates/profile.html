{% extends "base.html" %}

{% block title %}My Profile{% endblock %}

{% block content %}
<div class="app-container">
    <!-- Top Header with Hamburger and PMS -->
    <div class="top-header">
        <button class="hamburger-btn" onclick="toggleSidebar()">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>
        <h1 class="app-title">Open-Mic Participation Management System</h1>
        {% if current_user %}
        <div class="user-greeting">Hi, {{ current_user.first_name }}</div>
        {% endif %}
    </div>

    <!-- Sidebar -->
    {% from 'sidebar_macros.html' import render_sidebar %}
    {{ render_sidebar('profile') }}

    <!-- Main Content -->
    <div class="main-content">
        <div class="content-header" style="text-align:center;">
            <h1 style="margin:0;">My Profile</h1>
            <p style="margin:6px 0 0 0;">View and edit your account information</p>
            {% if message %}
            <p style="margin:10px 0 0 0;color:#38a169;font-weight:600;">{{ message }}</p>
            {% endif %}
        </div>
        <div class="content-body">
            <div style="width:100%;max-width:800px;margin:0 auto;">
                <form method="post" class="event-card" style="padding:24px;">
                    <div style="display:grid;grid-template-columns:1fr 2fr;gap:12px;row-gap:16px;align-items:center;">
                        <label for="first_name"><strong>First Name</strong></label>
                        <input id="first_name" name="first_name" type="text" value="{{ user.first_name }}" style="padding:10px 12px;border:1px solid #e2e8f0;border-radius:8px;">

                        <label for="last_name"><strong>Last Name</strong></label>
                        <input id="last_name" name="last_name" type="text" value="{{ user.last_name }}" style="padding:10px 12px;border:1px solid #e2e8f0;border-radius:8px;">

                        <label><strong>Email</strong></label>
                        <input type="email" value="{{ user.email }}" disabled style="padding:10px 12px;border:1px solid #e2e8f0;border-radius:8px;background:#f7fafc;color:#718096;">

                        <label><strong>Role</strong></label>
                        <input type="text" value="{{ session.user_type|capitalize }}" disabled style="padding:10px 12px;border:1px solid #e2e8f0;border-radius:8px;background:#f7fafc;color:#718096;">

                        <label for="phone_number"><strong>Phone</strong></label>
                        <input id="phone_number" name="phone_number" type="text" value="{{ user.phone_number or '' }}" style="padding:10px 12px;border:1px solid #e2e8f0;border-radius:8px;">

                        {% if session.user_type == 'participant' %}
                        <label for="city"><strong>City</strong></label>
                        <input id="city" name="city" type="text" value="{{ user.city or '' }}" style="padding:10px 12px;border:1px solid #e2e8f0;border-radius:8px;">

                        <label for="state"><strong>State</strong></label>
                        <input id="state" name="state" type="text" value="{{ user.state or '' }}" style="padding:10px 12px;border:1px solid #e2e8f0;border-radius:8px;">

                        <label for="country"><strong>Country</strong></label>
                        <input id="country" name="country" type="text" value="{{ user.country or '' }}" style="padding:10px 12px;border:1px solid #e2e8f0;border-radius:8px;">
                        {% endif %}

                        <label><strong>Active</strong></label>
                        <input type="text" value="{{ 'Yes' if user.is_active else 'No' }}" disabled style="padding:10px 12px;border:1px solid #e2e8f0;border-radius:8px;background:#f7fafc;color:#718096;">

                        <label><strong>Created</strong></label>
                        <input type="text" value="{{ user.created_at.strftime('%B %d, %Y %I:%M %p') if user.created_at else 'â€”' }}" disabled style="padding:10px 12px;border:1px solid #e2e8f0;border-radius:8px;background:#f7fafc;color:#718096;">
                    </div>

                    <div style="margin-top:20px;display:flex;gap:12px;">
                        <button type="submit" class="btn-primary">Save Changes</button>
                        <a href="{{ url_for('home') }}" class="btn-secondary">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const hamburgerBtn = document.querySelector('.hamburger-btn');
    sidebar.classList.toggle('sidebar-open');
    hamburgerBtn.classList.toggle('hamburger-active');
    const isOpen = sidebar.classList.contains('sidebar-open');
    sessionStorage.setItem('sidebarOpen', isOpen);
}

function closeSidebar() {
    const sidebar = document.getElementById('sidebar');
    const hamburgerBtn = document.querySelector('.hamburger-btn');
    sidebar.classList.remove('sidebar-open');
    hamburgerBtn.classList.remove('hamburger-active');
    sessionStorage.setItem('sidebarOpen', false);
}

document.addEventListener('DOMContentLoaded', function() {
    const sidebar = document.getElementById('sidebar');
    const hamburgerBtn = document.querySelector('.hamburger-btn');
    const sidebarOpen = sessionStorage.getItem('sidebarOpen');
    if (sidebarOpen === 'true') {
        sidebar.classList.add('sidebar-open');
        hamburgerBtn.classList.add('hamburger-active');
    }
});

document.addEventListener('click', function(event) {
    const sidebar = document.getElementById('sidebar');
    const hamburgerBtn = document.querySelector('.hamburger-btn');
    const navLinks = document.querySelectorAll('.nav-link');
    let isNavLink = false;
    navLinks.forEach(link => { if (link.contains(event.target)) { isNavLink = true; } });
    if (!sidebar.contains(event.target) && !hamburgerBtn.contains(event.target) && !isNavLink) {
        sidebar.classList.remove('sidebar-open');
        hamburgerBtn.classList.remove('hamburger-active');
        sessionStorage.setItem('sidebarOpen', false);
    }
});
</script>
{% endblock %}


